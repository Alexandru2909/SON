
<div class="main" style="margin-left: 21%;">
    <div class="page">
        <header>
            <span class="sidebar_icon" onclick="open_sidebar()"><i class="fa fa-bars"></i></span>
            <div class="container">
                <h1><b>Friends</b></h1>
                <div class="search_container">
                    <input type="text" placeholder="Search...">
                    <div class="search"></div>
                </div>
                <br>
                <div class="search_filter bottombar">
                    <span class="filter">Filter:</span>
                    <button class="filter-button white">All</button>
                    <div class="filter-select city">
                    <select>
                        <option value="0">City</option>
                    </select>
                    </div>
                    <div class="filter-select age">
                    <select>
                        <option value="0">Age</option>
                        <option>&#60; 18</option>
                        <option>&#60; 30</option>
                        <option>&#60; 50</option>
                        <option>&#62; 50</option>
                    </select>
                    </div>
                </div>
            </div>
        </header>
        <div class="row-padding" id="flist">
        </div>
    </div>
</html>

<script>
    customSelect("filter-select age");
    customSelect("filter-select city");
    getFriendsList();
    function getFriendsList(){
        networks = ['lastfm'];
        for ( var net in networks){
            $.ajax({
                url: '/functions',
                type: 'POST',
                contentType: 'application/json',
                dataType: 'json',
                data: JSON.stringify({func: 'getFriends1',network: networks[net]}),
                success: (data) => {
                    for(user in data.response){
                        fetch('http://ws.audioscrobbler.com/2.0/?method=user.getinfo&user=' + user + '&api_key=a0a04802c25d3f828bf43e8c54e50ed8&format=json')
                        .then(response => response.json())
                        .then(data => {
                            var node = `<div class='user_profile'><img alt='Profile pic' src=${data.image}><p><b>Name:${data.name}</b></p><p>Real name:${data.realname} </p><p>Country:${data.country}</p><p>Age:${data.age}</p></div>`;
                            console.log(node);
                            $('#flist').append(node);
                        })
                        .catch(err => {
                    console.error('Fetch error:', err);
                        });
                    }
                }
            });
        }
    }

    function customSelect(selectClassName){
        var select, i, j, setElement, selectedItem, optionList, option;
        select = document.getElementsByClassName(selectClassName)
        for(i = 0; i< select.length; i++){
            setElement = select[i].getElementsByTagName("select")[0];
            selectedItem = document.createElement("DIV");
            selectedItem.setAttribute("class", "select-selected");
            selectedItem.innerHTML = setElement.options[setElement.selectedIndex].innerHTML;
            select[i].appendChild(selectedItem);

            optionList = document.createElement("DIV");
            optionList.setAttribute("class", "select-items select-hide");
            for(j = 1; j < setElement.length; j++){
                option = document.createElement("DIV");
                option.innerHTML = setElement.options[j].innerHTML;
                option.addEventListener("click", function(e) {
                    var y, i, k, s, h;
                    s = this.parentNode.parentNode.getElementsByTagName("select")[0];
                    h = this.parentNode.previousSibling;
                    for(i = 0; i<s.length; s++){
                        if(s.options[i].innerHTML == this.innerHTML) {
                            s.selectedIndex = i;
                            h.innerHTML = this.innerHTML;
                            y = this.parentNode.getElementsByClassName("same-as-selected");
                            for(k = 0; k < y.length; k++){
                                y[k].removeAttribute("class");
                            }
                            this.setAttribute("class", "same-as-selected");
                            break;
                        }
                    }
                    h.click();
                });
                optionList.appendChild(option);
            }
            select[i].appendChild(optionList);
            selectedItem.addEventListener("click", function(e){
                e.stopPropagation();
                closeAllSelect(this);
                this.nextSibling.classList.toggle("select-hide");
                this.classList.toggle("select-arrow-active");
            });
        }

        function closeAllSelect(element){
            var x, y, i, arrNo = [];
            x = document.getElementsByClassName("select-items");
            y = document.getElementsByClassName("select-selected");
            for(i = 0; i < y.length; i++){
                if(element == y[i]){
                    arrNo.push(i);
                } else {
                    y[i].classList.remove("select-arrow-active");
                }
            }

            for(i = 0; i<x.length; i++){
                if(arrNo.indexOf(i)){
                    x[i].classList.add("select-hide");
                }
            }
        }
        document.addEventListener("click", closeAllSelect);
    }
</script>